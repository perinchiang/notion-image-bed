name: Compress Images
on:
  push:
    paths:
      - 'images/**'  # ç›‘å¬ images æ–‡ä»¶å¤¹
  workflow_dispatch: # æ”¯æŒæ‰‹åŠ¨è§¦å‘

permissions:
  contents: write # âš ï¸ å¿…é¡»ç»™å†™æƒé™ï¼Œå¦åˆ™æ— æ³•æäº¤å‹ç¼©åçš„å›¾ç‰‡

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      # 1. å®‰è£…å‹ç¼©å·¥å…· (Linux åŸç”Ÿå·¥å…·ï¼Œé€Ÿåº¦æå¿«)
      - name: Install Tools
        run: sudo apt-get update && sudo apt-get install -y jpegoptim optipng

      # 2. æ‰§è¡Œå‹ç¼© (åªå‹ç¼© images ç›®å½•)
      - name: Compress Images
        run: |
          # å‹ç¼© JPG (è´¨é‡80%, å‰¥ç¦»å…ƒæ•°æ®)
          find images -name '*.jpg' -o -name '*.jpeg' | xargs -r jpegoptim -m80 --strip-all
          
          # å‹ç¼© PNG (ä¼˜åŒ–çº§åˆ« 2)
          find images -name '*.png' | xargs -r optipng -o2

      # 3. æäº¤æ›´æ”¹ (å¦‚æœå›¾ç‰‡å˜å°äº†ï¼Œå°±æäº¤å›å»)
      - name: Commit & Push changes
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«ä¿®æ”¹
          if [[ -n $(git status -s) ]]; then
            git add images/*
            git commit -m "ğŸ“‰ Auto Compress Images [skip ci]"
            git push
            echo "âœ… Images compressed and pushed."
          else
            echo "âœ¨ No images needed compression."
          fi
